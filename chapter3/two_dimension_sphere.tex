\section{На двумерной сфере}

Рассмотрим аналогичную задачу на двумерной сфере. Дан набор $k$ точек $\{p_i\}$, лежащих на поверхности сферы $S^2$, и
нужно построить непрерывно-дифференци\-руемую кривую до заданного порядка, проходящую последовательно через все эти
точки и лежащую на поверхности $S^2$.

\subsection*{Построение малой дуги}

Рассмотрим вначале некоторые три различные точки $p_1, p_2, p_3$, лежащие на поверхности $S^2$, и поговорим о
том, как построить малую дугу, проходящую последовательно через эти три точки. Дуга будет являться результатом поворота
точки $p_1$ вокруг некоторой оси $n$ вначале на угол $\phi$ до точки $p_2$, и затем на угол $\psi$ до точки $p_3$.
Точки $p_1, p_2, p_3$ лежат на малой окружности, и центр этой окружности мы обозначим $c$.

Можно показать, что ось $n$ и центр малой окружности $c$ выражаются следующими формулами:

\begin{equation}
n=\frac{(p_3-p_2)\times(p_1-p_2)}{|(p_3-p_2)\times(p_1-p_2)|},
\label{two-dimenstion-sphere-axis}
\end{equation}

$$
c=\frac{[p_1p_2p_3]}{|(p_3-p_2)\times(p_1-p_2)|}n.
$$

Далее определим углы $\phi$ и $\psi$:

$$
\phi=\angle P_1CP_2, \quad \psi=\angle P_2CP_3.
$$

Для краткости введём дополнительные обозначения:

$$
q_1=p_1-c, \quad q_2=p_2-c, \quad q_3=p_3-c,
$$

$$
r_1=|q_1\times q_2|, \quad r_2=|q_2\times q_3|,
$$

$$
s_1=q_1\cdot q_2, \quad s_2=q_2\cdot q_3.
$$

Тогда углы $\phi$ и $\psi$ можно определить по следующим формулам:

\begin{equation}
\phi=
 \begin{cases}
   \arctantwo(r_1,s_1),      & (q_1\times q_2)\cdot n>0, \\
   2\pi-\arctantwo(r_1,s_1), & (q_1\times q_2)\cdot n<0;
 \end{cases}
\label{two-dimension-sphere-phi-angle}
\end{equation}

\begin{equation}
\psi=
 \begin{cases}
   \arctantwo(r_2,s_2),      & (q_2\times q_3)\cdot n>0, \\
   2\pi-\arctantwo(r_2,s_2), & (q_2\times q_3)\cdot n<0.
 \end{cases}
\label{two-dimension-sphere-psi-angle}
\end{equation}

Теперь требуемая дуга малой окружности может быть описана следующей формулой:

$$
p(u)=R(n,u(\phi+\psi))p_1, \quad u \in [0,1].
$$

Кроме того, малые дуги от $p_1$ к $p_2$ и от $p_2$ к $p_3$ можно выразить следующим образом:

$$
f_1(u)=R(n,u\phi)p_1, \quad f_2(u)=R(n,u\psi)p_2, \quad u \in [0,1].
$$

\subsection*{Деформация малых дуг}

Теперь рассмотрим две различные точки $p_1$ и $p_2$, соединённые двумя различными малыми дугами. Пусть первая дуга
$p(u)$ будет результатом поворота точки $p_1$ вокруг оси $m$ на угол $\phi$, а вторая дуга $q(u)$ "--- результатом
поворота точки $p_1$ вокруг оси $n$ на угол $\psi$:

$$
p(u)=R(m,u\phi)p_1, \quad q(u)=R(n,u\psi)p_1, \quad u \in [0,1].
$$

Таким образом, кривые имеют следующие граничные точки:

$$
p(0)=q(0)=p_1, \quad p(1)=q(1)=p_2.
$$

Требуется построить новую кривую $r(u)$, удовлетворяющую следующим граничным условиям:

$$
r^{(k)}(0)=p^{(k)}(0), \quad r^{(k)}(1)=q^{(k)}(1),
$$

$$
k \in {0,1,\dots,l}, \quad l \in \mathbb{N}.
$$

В этом месте следует применить теорему о деформации кривых. Собственно ортогональные матрицы, представляющие повороты
точки $p_1$, принадлежат мультипликативной группе с операцией умножения матриц. Имеем две кривые в пространстве
собственно ортогональных матриц: $R(m,u\phi)$ и $R(n,u\psi)$. При $u=0$ они равняются единичной матрице, поэтому эти
кривые выходят из единицы мультипликативной группы. Значит, к ним можно применить теорему о деформации кривых.

Таким образом, можно показать, что искомая кривая $r(u)$ представима следующим образом:

$$
r(u)=R(n,w_l(u)u\psi)R(m,(1-w_l(u))u\phi)p_1, \quad u \in [0,1].
$$

\subsection*{Алгоритм построения кривой}

Приведём теперь детальное описание алгоритма построения кривой $r(t)$, проходящей через точки $p_1,\dots,p_k$.

\bigskip
\textit{Шаг} 1.

\begin{enumerate}
\item Вычислим ось $n_1$ для точек $p_1, p_2, p_3$ по формуле (\ref{two-dimenstion-sphere-axis}).
\item Вычислим центральные углы $\phi_1$ и $\psi_1$ для точек $p_1, p_2, p_3$ по формулам
(\ref{two-dimension-sphere-phi-angle}) и (\ref{two-dimension-sphere-psi-angle}).
\item Вычислим первый сегмент $r_1(t)$ кривой $r(t)$ по следующей формуле:
$$
r_1(t)=R(n_1,u(t)\phi_1)p_1,
$$
\noindent где
$$
u(t)=\frac{t-t_1}{t_2-t_1}, \quad t \in [t_1,t_2].
$$
\end{enumerate}

Здесь $w_l(t)$ "--- сглаживающие полиномы, и $l$ "--- требуемая степень непрерывности кривой $r(t)$. Значения $t_1$ и
$t_2$ следует выбирать, исходя из каких-либо дополнительных кинематических требований или ограничений.

\bigskip
\textit{Шаг} $i$, где $i \in \{2,3,\dots,k-2\}$.

\begin{enumerate}
\item Вычислим ось $n_i$ для точек $p_i, p_{i+1}, p_{i+2}$ по формуле (\ref{two-dimenstion-sphere-axis}).
\item Вычислим центральные углы $\phi_i$ и $\psi_i$ для точек $p_i, p_{i+1}, p_{i+2}$ по формулам
(\ref{two-dimension-sphere-phi-angle}) и (\ref{two-dimension-sphere-psi-angle}).
\item Вычислим сегмент $r_i(t)$ кривой $r(t)$ по следующей формуле:
$$
r_i(t)=R(n_i,w_l(u(t))u(t)\phi_i)R(n_{i-1},(1-w_l(u(t)))u(t)\psi_{i-1})p_i,
$$
\noindent где
$$
u(t)=\frac{t-t_i}{t_{i+1}-t_i}, \quad t \in [t_i,t_{i+1}].
$$
\end{enumerate}

Чтобы обеспечить параметрическую непрерывность кривой $r(t)$ в точках $p_i$, значения $t_i$ следует выбирать следующим
образом:

$$
t_{i+1}=t_i+\frac{t_i-t_{i-1}}{\phi_{i-1}}\psi_{i-1}, \quad i \in \{2,3,\dots,k-1\}.
$$

\bigskip
\textit{Шаг} ($k-1$).

Вычислим последний сегмент $r_{k-1}$ кривой $r(t)$ по следующей формуле:

$$
r_{k-1}=R(n_{k-2},u(t)\psi_{k-2})p_{k-1},
$$

\noindent где

$$
u(t)=\frac{t-t_{k-1}}{t_k-t_{k-1}}, \quad t \in [t_{k-1},t_k].
$$

Чтобы обеспечить параметрическую непрерывность кривой $r(t)$ в точке $p_{k-1}$, значение $t_k$ следует выбирать
следующим образом:

$$
t_k=t_{k-1}+\frac{t_{k-1}-t_{k-2}}{\phi_{k-2}}\psi_{k-2}.
$$
