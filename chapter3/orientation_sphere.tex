\section{На ориентационной сфере}

Рассмотрим теперь ту же задачу на ориентационной сфере. Дан набор $k$ ориентаций $\{Q_i\}$, лежащих на поверхности
единичной сферы $S^3$, и нужно построить непрерывно-дифференцируемую до заданного порядка кривую, проходящую
последовательно через все эти ориентации и лежащую на поверхности единичной сферы $S^3$.

\subsection*{Построение малой дуги}

Рассмотрим вначале некоторые три различные ориентации $Q_1, Q_2, Q_3$, лежащие на поверхности $S^3$, и поговорим о
том, как построить малую дугу, проходящую последовательно через эти три ориентации.

Для этого определим вначале единичный кватернион $H$, используя векторное произведение:

\begin{equation}
H=\frac{Q_1 \times Q_2 \times Q_3}{|Q_1 \times Q_2 \times Q_3|}.
\label{orientation-axis}
\end{equation}

Также определим единичные кватернионы $R_i$:

$$
R_i=Q_iH^*=m_i, \quad i \in \{1,2,3\}.
$$

Здесь $m_i$ "--- векторные части кватернионов $R_i$, их можно так выразить, потому что $R_i$ имеют нулевую скалярную
часть. Кроме того, $m_i$ являются единичными осями.

Таким образом, получили, что $m_i$ "--- точки на двумерной сфере $S^2$. Поэтому можем применить формулу
(\ref{two-dimension-arc}) из предыдущего раздела, чтобы вычислить малую дугу на сфере $S^2$. Обозначим $n, \phi, \psi$,
соответственно, ось и центральные углы поворота, образующего эту малую дугу. Тогда:

$$
r(u)=R(n,u(\psi+\psi))m_1, \quad u \in [0,1].
$$

Определим теперь через $r(u)$ другую параметризованную кривую $R(u)$, лежащую на единичной сфере кватернионов:

\begin{equation*}
R(u)=
\left[ {\begin{array}{c}
  0 \\
  r(u) \\
\end{array} } \right].
\end{equation*}

Далее выразим иготовую параметризованную кривую $P(u)$, которая и будет являться малой дугой:

$$
P(u)=R(u)H=R(u)R_1^*Q_1=\tilde R(u)Q_1=R(n,u(\phi+\psi))Q_1.
$$

В данной записи под $R(n,u(\phi+\psi))$ подразумевается кривая, лежащая на единичной сфере кватернионов. В этом
случае кватернионы кривой используются для представления поворотов.

Кроме того, малые дуги от $Q_1$ к $Q_2$ и от $Q_2$ к $Q_3$ можно выразить следующим образом:

$$
F_1(u)=R(n,u\phi)Q_1, \quad F_2(u)=R(n,u\psi)Q_2, \quad u \in [0,1].
$$

\subsection*{Деформация малых дуг}

Теперь рассмотрим две различные ориентации $Q_1$ и $Q_2$, соединённые двумя различными малыми дугами. Пусть первая дуга
$P(u)$ будет результатом поворота точки $Q_1$ вокруг оси $m$ на угол $\phi$, а вторая дуга $Q(u)$ "--- результатом
поворота точки $Q_1$ вокруг оси $n$ на угол $\psi$:

$$
P(u)=R(m,u\phi)Q_1, \quad Q(u)=R(n,u\psi)Q_1, \quad u \in [0,1].
$$

Таким образом, кривые имеют следующие граничные точки:

$$
P(0)=Q(0)=Q_1, \quad P(1)=Q(1)=Q_2.
$$

Требуется построить новую кривую $R(u)$, удовлетворяющую следующим граничным условиям:

$$
R^{(k)}(0)=P^{(k)}(0), \quad R^{(k)}(1)=Q^{(k)}(1),
$$

$$
k \in {0,1,\dots,l}, \quad l \in \mathbb{N}.
$$

Применим теорему о деформации кривых. Единичные кватернионы, представляющие повороты ориентации $Q_1$, принадлежат
мультипликативной группе с операцией умножения кватернионов. Имеем две кривые в пространстве единичных кватернионов:
$R(m,u\phi)$ и $R(n,u\psi)$. При $u=0$ они равняются единице, поэтому эти кривые выходят из единицы мультипликативной
группы. Значит, к ним можно применить теорему о деформации кривых.

Таким образом, можно показать, что искомая кривая $R(u)$ представима следующим образом:

$$
R(u)=R(n,w_l(u)u\psi)R(m,(1-w_l(u))u\phi)Q_1, \quad u \in [0,1].
$$

\subsection*{Алгоритм построения кривой}

Приведём теперь детальное описание алгоритма построения кривой $R(t)$, проходящей через ориентации $Q_1,\dots,Q_k$.

\bigskip
\textit{Шаг} 1.

\begin{enumerate}
\item Вычислим единичный кватернион $N_1$ по формуле (\ref{orientation-axis}) для ориентаций $Q_1$, $Q_2$, $Q_3$.
\item Вычислим ось $n_1$ и центральные углы $\phi_1$ и $\psi_1$ для ориентаций $Q_1,Q_2,Q_3$, используя формулы из
предыдущего раздела.
\item Вычислим первый сегмент $R_1(t)$ кривой $R(t)$ по следующей формуле:
$$
R_1(t)=R(n_1,u(t)\phi_1)Q_1,
$$
\noindent где
$$
u(t)=\frac{t-t_1}{t_2-t_1}, \quad t \in [t_1,t_2].
$$
\end{enumerate}

Значения $t_1$ и $t_2$ следует выбирать, исходя из каких-либо дополнительных кинематических требований или ограничений.

\bigskip
\textit{Шаг} $i$, где $i \in \{2,3,\dots,k-2\}$.

\begin{enumerate}
\item Вычислим единичный кватернион $N_i$ по формуле (\ref{orientation-axis}) для ориентаций $Q_i$, $Q_{i+1}$,
$Q_{i+2}$.
\item Вычислим оси $n_i$ и центральные углы $\phi_i$ и $\psi_i$ для ориентаций $Q_i, Q_{i+1}, Q_{i+2}$, используя
формулы из предыдущего раздела.
\item Вычислим сегмент $R_i(t)$ кривой $R(t)$ по следующей формуле:
$$
R_i(t)=R(n_i,w_l(u(t))u(t)\phi_i)R(n_{i-1},(1-w_l(u(t)))u(t)\psi_{i-1})Q_i,
$$
\noindent где
$$
u(t)=\frac{t-t_i}{t_{i+1}-t_i}, \quad t \in [t_i,t_{i+1}].
$$
\end{enumerate}

Здесь $w_l(t)$ "--- сглаживающие полиномы, и $l$ "--- требуемая степень непрерывности кривой $R(t)$. Чтобы обеспечить
параметрическую непрерывность кривой $R(t)$ в точках $Q_i$, значения $t_i$ следует выбирать следующим образом:

$$
t_{i+1}=t_i+\frac{t_i-t_{i-1}}{\phi_{i-1}}\psi_{i-1}, \quad i \in \{2,3,\dots,k-2\}.
$$

\bigskip
\textit{Шаг} ($k-1$).

Вычислим последний сегмент $R_{k-1}$ кривой $R(t)$ по следующей формуле:

$$
R_{k-1}=R(n_{k-2},u(t)\psi_{k-2})Q_{k-1},
$$

\noindent где

$$
u(t)=\frac{t-t_{k-1}}{t_k-t_{k-1}}, \quad t \in [t_{k-1},t_k].
$$

Чтобы обеспечить параметрическую непрерывность кривой $R(t)$ в точке $Q_{k-1}$, значение $t_k$ следует выбирать
следующим образом:

$$
t_k=t_{k-1}+\frac{t_{k-1}-t_{k-2}}{\phi_{k-2}}\psi_{k-2}.
$$
