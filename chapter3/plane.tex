\section{На плоскости}

Рассмотрим задачу построения кривой по набору точек на плоскости. Дан набор $k$ точек $\{p_i\}$ в $\mathbb{R}^2$, и
нужно построить непрерывно-дифференцируемую до заданного порядка кривую, проходящую последовательно через все эти
точки.

\subsection*{Построение дуги по трём точкам}

Рассмотрим вначале некоторые три различные точки $p_1, p_2, p_3$ на $\mathbb{R}^2$, и поговорим о том, как построить
дугу, проходящую последовательно через эти три точки. Дуга будет являться результатом поворота точки $p_1$ вокруг
некоторой точки $c$ вначале на угол $\phi$ до точки $p_2$, и затем на угол $\psi$ до точки $p_3$.

Вычислим уравнения серединных перпендикуляров для пары точек $p_1$ и $p_2$, а также для $p_2$ и $p_3$. Затем найдём
пересечение этих прямых, это и будет точка $c$ "--- центр окружности.

Вычислим углы $\alpha_1,\alpha_2,\alpha_3$, которые образуют с осью $Ox$ отрезки, соединяющие точки $p_1, p_2, p_3$ с
центром окружности $c$.

$$
\alpha_i=\arctantwo((p_i-c)_y,(p_i-c)_x), \quad i \in \{1,2,3\}.
$$

Далее определим углы $\phi$ и $\psi$:

$$
\phi=\angle P_1CP_2, \quad \psi=\angle P_2CP_3.
$$

\begin{equation}
\phi=
  \begin{cases}
    \alpha_2-\alpha_1,      & \alpha_2>\alpha_1, \\
    \alpha_2-\alpha_1+2\pi, & \alpha_2<\alpha_1;
  \end{cases}
  \label{plane-phi}
\end{equation}

\begin{equation}
\psi=
  \begin{cases}
    \alpha_3-\alpha_2,      & \alpha_3>\alpha_2, \\
    \alpha_3-\alpha_2+2\pi, & \alpha_3<\alpha_2.
  \end{cases}
  \label{plane-psi}
\end{equation}

Теперь если оказалось, что $\phi+\psi>2\pi$, сделаем переприсвоение:

\begin{equation}
\phi:=\phi-2\pi, \quad \psi:=\psi-2\pi.
\label{angle-correction}
\end{equation}

Вычислим радиус окружности $r$:

$$
r=|p_1-c|.
$$

Теперь требуемая дуга малой окружности может быть описана следующей формулой:

$$
p(u)=c+(r\cos(\alpha_1+u(\phi+\psi)),r\sin(\alpha_1+u(\phi+\psi))), \quad u \in [0,1].
$$

Кроме того, дуги от $p_1$ к $p_2$ и от $p_2$ к $p_3$ можно выразить следующим образом:

\begin{equation}
f_1(u)=c+(r\cos(\alpha_1+u\phi),r\sin(\alpha_1+u\phi)), \quad u \in [0,1];
\label{arc-phi}
\end{equation}

\begin{equation}
f_2(u)=c+(r\cos(\alpha_2+u\psi),r\sin(\alpha_2+u\psi)), \quad u \in [0,1].
\label{arc-psi}
\end{equation}

\subsection*{Деформация дуг}

Теперь рассмотрим две различные точки $p_1$ и $p_2$, соединённые двумя различными дугами $p(u)$ и $q(u)$. То есть эти
дуги имеют следующие граничные точки:

$$
p(0)=q(0)=p_1, \quad p(1)=q(1)=p_2.
$$

Требуется построить новую кривую $r(u)$, удовлетворяющую следующим граничным условиям:

$$
r^{(k)}(0)=p^{(k)}(0), \quad r^{(k)}(1)=q^{(k)}(1),
$$

$$
k \in {0,1,\dots,l}, \quad l \in \mathbb{N}.
$$

Применим теорему о деформации кривых. Векторы пространства $\mathbb{R}^2$ принадлежат мультипликативной группе с
операцией сложения векторов. Имеем две кривые в пространстве $\mathbb{R}^2$:

$$
\tilde p(u)=p(u)-p_1, \quad \tilde q(u)=q(u)-p_1, \quad u \in [0,1].
$$

При $u=0$ они обращаются в ноль, поэтому эти кривые выходят из единицы мультипликативной группы. Значит, к ним можно
применить теорему о деформации кривых.

Таким образом, можно показать, что искомая кривая $r(u)$ представима следующим образом:

\begin{equation}
r(u)=\tilde q(w_l(u)u)+\tilde p((1-w_l(u))u)+p_1, \quad u \in [0,1].
\label{plane-deformed-curve}
\end{equation}

\subsection*{Алгоритм построения кривой}

Приведём теперь детальное описание алгоритма построения кривой $r(t)$, проходящей через точки $p_1,\dots,p_k$.

\bigskip
\textit{Шаг} 1.

\begin{enumerate}
\item Вычислим углы $\phi_1$ и $\psi_1$ между точками $p_1,p_2,p_3$ по формулам (\ref{plane-phi}), (\ref{plane-psi}) и
(\ref{angle-correction}).
\item Вычислим дуги $s_1(u)$ и $v_1(u)$ между точками $p_1,p_2,p_3$ по формулам (\ref{arc-phi}) и (\ref{arc-psi}).
\item Вычислим первый сегмент $r_1(t)$ кривой $r(t)$ по следующей формуле:
$$
r_1(t)=s_1(u(t)),
$$
\noindent где
$$
u(t)=\frac{t-t_1}{t_2-t_1}, \quad t \in [t_1,t_2].
$$
\end{enumerate}

Значения $t_1$ и $t_2$ следует выбирать, исходя из каких-либо дополнительных кинематических требований или ограничений.

\bigskip
\textit{Шаг} $i$, где $i \in \{2,3,\dots,k-2\}$.

\begin{enumerate}
\item Вычислим углы $\phi_i$ и $\psi_i$ между точками $p_i,p_{i+1},p_{i+2}$ по формулам (\ref{plane-phi}),
(\ref{plane-psi}) и (\ref{angle-correction}).
\item Вычислим дуги $s_i(u)$ и $v_i(u)$ между точками $p_i,p_{i+1},p_{i+2}$ по формулам (\ref{arc-phi}) и
(\ref{arc-psi}).
\item Вычислим $i$-й сегмент $r_i(t)$ кривой $r(t)$ по следующей формуле:
$$
r_i(u(t))=s_i(w_l(u(t))u(t))+v_{i-1}((1-w_l(u(t)))u(t))+p_1,
$$
\noindent где
$$
u(t)=\frac{t-t_i}{t_{i+1}-t_i}, \quad t \in [t_i,t_{i+1}].
$$
\end{enumerate}

Здесь $w_l(t)$ "--- сглаживающие полиномы, и $l$ "--- требуемая степень непрерывности кривой $r(t)$. Чтобы обеспечить
параметрическую непрерывность кривой $r(t)$ в точках $p_i$, значения $t_i$ следует выбирать следующим образом:

$$
t_{i+1}=t_i+\frac{t_i-t_{i-1}}{|\phi_{i-1}|}|\psi_{i-1}|, \quad i \in \{2,3,\dots,k-2\}.
$$

\bigskip
\textit{Шаг} ($k-1$).

Вычислим последний сегмент $r_{k-1}(t)$ кривой $r(t)$ по следующей формуле:

$$
r_{k-1}(t)=v_{k-2}(u(t)),
$$

\noindent где

$$
u(t)=\frac{t-t_{k-1}}{t_k-t_{k-1}}, \quad t \in [t_{k-1},t_k].
$$

Чтобы обеспечить параметрическую непрерывность кривой $r(t)$ в точке $p_{k-1}$, значение $t_k$ следует выбирать
следующим образом:

$$
t_k=t_{k-1}+\frac{t_{k-1}-t_{k-2}}{|\phi_{k-2}|}|\psi_{k-2}|.
$$
