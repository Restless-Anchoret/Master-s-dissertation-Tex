\section{На двумерной сфере}

Рассмотрим аналогичную задачу на двумерной сфере. Дан набор $k$ точек $\{p_i\}$, лежащих на поверхности сферы $S^2$.
Нужно построить непрерывно-дифференци\-руемую до заданного порядка кривую Безье, лежащую на поверхности $S^2$, на
основе данного набора точек.

\subsection*{Построение большой дуги}

Рассмотрим вначале некоторые две различные точки $p_1$ и $p_2$, лежащие на поверхности $S^2$, и поговорим о том, как
построить большую дугу, соединяющую эти две точки. Дуга будет являться результатом поворота точки $p_1$ вокруг
некоторой оси $n$ на угол $\varphi$ до точки $p_2$.

Можно показать, что ось $n$ выражается следующей формулой:

\begin{equation}
n=\frac{p_1\times p_2}{|p_1\times p_2|}.
\label{two-dimension-sphere-bezier-axis}
\end{equation}

Далее выразим центральный угол $\varphi=\angle P_1OP_2$, который определяет поворот искомой дуги:

\begin{equation}
\varphi=\arctan\left(\frac{|p_1\times p_2|}{p_1\cdot p_2}\right).
\label{two-dimension-sphere-bezier-angle}
\end{equation}

Теперь требуемая дуга большой окружности может быть описана следующей формулой:

\begin{equation}
p(u)=R(n,u\varphi)p_1, \quad u \in [0,1].
\label{two-dimension-big-arc}
\end{equation}

Кроме того, точка, лежащая на середине этой дуги, может быть найдена по формуле:

\begin{equation}
q=R(n,\frac{\varphi}{2})p_1.
\label{two-dimension-big-arc-mid}
\end{equation}

Также две половины большой дуги, сходящиеся, соответственно, от точек $p_1$ и $p_2$ к точке $q$ выражаются формулами:

\begin{equation}
s(u)=R(n,\frac{u}{2}\varphi)p_1, \quad v(u)=R(n,(1-\frac{u}{2})\varphi)p_1, \quad u \in [0,1].
\label{two-dimension-big-arc-halfs}
\end{equation}

\subsection*{Сглаживание больших дуг}

Теперь рассмотрим три различные точки $p_1$, $p_2$ и $p_3$, соединённые последовательно двумя большими
дугами. Пусть первая дуга $p(u)$ будет результатом поворота точки $p_2$ вокруг оси $m$ на угол $\varphi$ до точки $p_1$,
а вторая дуга $q(u)$ "--- результатом поворота точки $p_2$ вокруг оси $n$ на угол $\psi$ до точки $p_3$:

$$
p(u)=R(m,u\varphi)p_2, \quad q(u)=R(n,u\psi)p_2, \quad u \in [0,1].
$$

Таким образом, кривые имеют следующие граничные точки:

$$
p(0)=q(0)=p_2, \quad p(1)=p_1, \quad q(1)=p_3.
$$

Требуется построить новую кривую $r(u)$, удовлетворяющую следующим граничным условиям:

$$
r^{(k)}(0)=p^{(k)}(1), \quad r^{(k)}(1)=q^{(k)}(1),
$$

$$
k \in {0,1,\dots,l}, \quad l \in \mathbb{N}.
$$

Применим теорему о сглаживании кривых. Собственно ортогональные матрицы, представляющие повороты
точки $p_2$, принадлежат мультипликативной группе с операцией умножения матриц. Имеем две кривые в пространстве
собственно ортогональных матриц: $R(m,u\varphi)$ и $R(n,u\psi)$. При $u=0$ они равняются единичной матрице, поэтому эти
кривые выходят из единицы мультипликативной группы. Значит, к ним можно применить теорему о сглаживании кривых.

Таким образом, можно показать, что искомая кривая $r(u)$ представима следующим образом:

$$
r(u)=R(n,\omega_l(u)u\psi)R(m,(1-\omega_l(u))(1-u)\varphi)p_2, \quad u \in [0,1].
$$

\subsection*{Алгоритм построения кривой}

Приведём теперь детальное описание алгоритма построения кривой Безье $r(t)$ на основе точек $p_1,\dots,p_k$.

\bigskip
\textit{Шаг} 0.

\begin{enumerate}
\item Вычислим оси $n_i$ и центральные углы $\varphi_i$ для каждой пары последовательных точек $p_i$ и $p_{i+1}$ для
$i \in \{1,\dots,k-1\}$, используя формулы (\ref{two-dimension-sphere-bezier-axis}) и
(\ref{two-dimension-sphere-bezier-angle}).
\item Построим большие дуги $p_i(u)$ между каждой парой последовательных точек $p_i$ и $p_{i+1}$ для
$i \in \{1,\dots,k-1\}$, используя формулу (\ref{two-dimension-big-arc}).
\item Определим точки $q_i$, $i \in \{1,\dots,k-1\}$, как середины больших дуг $p_i(u)$, используя формулу
(\ref{two-dimension-big-arc-mid}).
\item Определим половины больших дуг $s_i(u)$ и $v_i(u)$, $i \in \{1,\dots,k-1\}$ при помощи формулы
(\ref{two-dimension-big-arc-halfs}).
\end{enumerate}

\bigskip
\textit{Шаг} 1.

Определим первый сегмент $r_1(t)$ кривой $r(t)$ по следующей формуле:

$$
r_1(t)=s_1(u(t)),
$$
\noindent где
$$
u(t)=\frac{t-t_1}{t_2-t_1}, \quad t \in [t_1,t_2].
$$

Значения $t_1$ и $t_2$ следует выбирать, исходя из каких-либо дополнительных кинематических требований или ограничений.

\bigskip
\textit{Шаг} $i$, где $i \in \{2,3,\dots,k-1\}$.

Вычислим сегмент $r_i(t)$ кривой $r(t)$ по следующей формуле:
$$
r_i(t)=R(n_i,\omega_l(u(t))u(t)\frac{\varphi_i}{2})R(n_{i-1},(1-\omega_l(u(t)))(1-u(t))(-\frac{\varphi_{i-1}}{2}))p_i,
$$
\noindent где
$$
u(t)=\frac{t-t_i}{t_{i+1}-t_i}, \quad t \in [t_i,t_{i+1}].
$$

Здесь $\omega_l(t)$ "--- сглаживающие полиномы, и $l$ "--- требуемая степень непрерывности кривой $r(t)$. Чтобы обеспечить
параметрическую непрерывность кривой $r(t)$ в точках $q_i$, значения $t_i$ следует выбирать следующим образом:

$$
t_{i+1}=t_i+(t_i-t_{i-1}), \quad i \in \{2,3,\dots,k-1\}.
$$

\bigskip
\textit{Шаг} $k$.

Вычислим последний сегмент $r_k(t)$ кривой $r(t)$ по следующей формуле:

$$
r_k(t)=v_{k-1}(1-u(t)),
$$

\noindent где

$$
u(t)=\frac{t-t_k}{t_{k+1}-t_k}, \quad t \in [t_k,t_{k+1}].
$$

Чтобы обеспечить параметрическую непрерывность кривой $r(t)$ в точке $q_{k-1}$, значение $t_{k+1}$ следует выбирать
следующим образом:

$$
t_{k+1}=t_k+(t_k-t_{k-1}).
$$
